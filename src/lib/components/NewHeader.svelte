<script>
  import { goto } from "$app/navigation";
  import { page } from "$app/stores";
  import { query } from "$lib/store";
  import { fade } from "svelte/transition";

  const handleInput = (e) => {
    if (e.key === "Enter" && $query !== "") {
      let q = encodeURI($query);
      goto(`/search/songs?q=${q}`);
    }
  };

  if ($query === "") {
    $query = $page.url.searchParams.get("q") || "";
  }
  let isShown = false;
</script>

<div class="header flex flex-ac">
  <svg
    class="paattu glow"
    width="40"
    height="40"
    viewBox="0 0 8.4667 8.4667"
    xmlns="http://www.w3.org/2000/svg"
    ><g transform="matrix(1.0369 0 0 1.0369 0 -.31419)"
      ><path
        d="m1.7991 5.2696q0 0.30446-0.15223 0.40133h0.87186v-2.9097h0.63314v3.3664h-2.1831v-0.42555q0.19721-0.034598 0.19721-0.30792v-0.83726q0-0.30446-0.26986-0.30446-0.26986 0-0.26986 0.30446v0.83034q0 0.30446 0.15569 0.31484v0.43593q-0.78191 0-0.78191-0.70925v-0.9203q0-0.50513 0.55356-0.67811 0.16261-0.048437 0.43939-0.048437 0.27678 0 0.53972 0.20413 0.2664 0.20413 0.2664 0.52243z"
        stroke-width="24.196"
      /><path
        d="m4.3074 3.1487q-0.26294 0-0.26294 0.301v0.57778h-0.59162v-0.59508q0.00346-0.51205 0.52934-0.70233 0.15223-0.055356 0.41517-0.055356 0.2664 0 0.53626 0.22834 0.26986 0.22834 0.26986 0.56394v1.9548q0 0.51897-0.56394 0.70579-0.16261 0.055356-0.42555 0.051897-0.25948 0-0.51205-0.19721-0.2491-0.19721-0.2491-0.52589v-0.56048h0.59162v0.51897q0 0.30446 0.26294 0.30446t0.26294-0.26986v-2.0343q0-0.17299-0.10725-0.21797-0.10379-0.048436-0.15569-0.048437z"
        stroke-width="24.196"
      /><path
        d="m6.9047 5.5395q0.20316 0.17991 0.20316 0.45669v0.41517q0 0.52934-0.56199 0.68849-0.14512 0.041517-0.35355 0.041517-0.20844 0.00346-0.44854-0.16953-0.29287-0.20759-0.29287-0.56048v-0.21796h0.55936v0.21451q0 0.301 0.25593 0.301 0.25857 0 0.25857-0.42555l-0.00264-0.18337q0-0.301-0.25329-0.301h-0.69128v-0.49821h0.70183q0.26912 0 0.26912-0.26986v-0.14877q0-0.30446-0.36939-0.32522-0.48284-0.027678-0.67281-0.42209-0.052769-0.11417-0.055408-0.25948v-0.46707q-0.00264-0.52588 0.56199-0.69195 0.14248-0.041517 0.34828-0.041517 0.20844-0.00346 0.47756 0.19375 0.26912 0.19721 0.26912 0.53972v0.41863h-0.55672v-0.41171q0-0.30792-0.25857-0.30792-0.25593 0-0.25593 0.30792v0.41517q-0.00264 0.3183 0.36675 0.32522 0.4459 0.013839 0.64906 0.42901 0.055408 0.11417 0.055408 0.25948v0.22834q0 0.2837-0.20316 0.46707z"
        stroke-width="21.13"
      /><path
        d="m8.0328 1.6299q0.021811 0.096874 0.021811 0.11417v0.22488q0 0.43939-0.32094 0.602-0.10283 0.051897-0.23058 0.051897h-0.38949q-0.41442 0-0.57645-0.39441-0.049855-0.12109-0.049855-0.2664v-0.21797q0-0.017299 0.021811-0.11417h0.59514q-0.021811 0.096874-0.021811 0.11417v0.24564q0 0.19375 0.23058 0.19375 0.2337 0 0.2337-0.18683v-0.25256q0-0.017299-0.021811-0.11417z"
        stroke-width="22.962"
      /><path
        d="m7.7536 5.3111q0.41171 0 0.41171 0.41863 0 0.20067-0.10725 0.31138-0.10379 0.10725-0.30446 0.10725t-0.31138-0.10725q-0.10725-0.11071-0.10725-0.30792 0-0.20067 0.10725-0.31138 0.11071-0.11071 0.31138-0.11071z"
        stroke-width="24.196"
      /></g
    ></svg
  >

  {#if isShown}
    <input
      transition:fade
      type="text"
      bind:value={$query}
      placeholder="Search..."
      on:keypress={handleInput}
      autocomplete="off"
    />
  {/if}

  <div class="buttons flex flex-ac">
    <!-- svelte-ignore a11y-click-events-have-key-events -->
    <svg
      class="glow search"
      on:click={() => (isShown = !isShown)}
      xmlns="http://www.w3.org/2000/svg"
      width="32"
      height="32"
      viewBox="0 0 24 24"
      ><path
        fill="none"
        stroke="currentColor"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2.5"
        d="m21 21l-4.343-4.343m0 0A8 8 0 1 0 5.343 5.343a8 8 0 0 0 11.314 11.314Z"
      /></svg
    >

    <a
      href="https://github.com/theoisdumb/paattu"
      target="_blank"
      rel="noreferrer"
    >
      <svg
        class="glow github"
        xmlns="http://www.w3.org/2000/svg"
        width="32"
        height="32"
        viewBox="0 0 24 24"
        ><path
          fill="currentColor"
          d="M12.001 2c-5.525 0-10 4.475-10 10a9.994 9.994 0 0 0 6.837 9.488c.5.087.688-.213.688-.476c0-.237-.013-1.024-.013-1.862c-2.512.463-3.162-.612-3.362-1.175c-.113-.288-.6-1.175-1.025-1.413c-.35-.187-.85-.65-.013-.662c.788-.013 1.35.725 1.538 1.025c.9 1.512 2.337 1.087 2.912.825c.088-.65.35-1.087.638-1.337c-2.225-.25-4.55-1.113-4.55-4.938c0-1.088.387-1.987 1.025-2.688c-.1-.25-.45-1.275.1-2.65c0 0 .837-.262 2.75 1.026a9.28 9.28 0 0 1 2.5-.338c.85 0 1.7.112 2.5.337c1.913-1.3 2.75-1.024 2.75-1.024c.55 1.375.2 2.4.1 2.65c.637.7 1.025 1.587 1.025 2.687c0 3.838-2.337 4.688-4.563 4.938c.363.312.676.912.676 1.85c0 1.337-.013 2.412-.013 2.75c0 .262.188.574.688.474A10.016 10.016 0 0 0 22 12c0-5.525-4.475-10-10-10Z"
        /></svg
      >
    </a>
  </div>
</div>

<style>
  div.header {
    justify-content: space-between;
    height: 2.5rem;
  }
  div.buttons {
    gap: 0.5rem;
  }
  a {
    all: unset;
    height: 32px;
  }
  input[type="text"] {
    background-color: transparent;
    color: var(--fg);
    text-align: center;
    border: 0.08rem solid gray;
    border-radius: 0.3rem;
    outline: 0;
    transition: all 0.3s;
  }
  input[type="text"]:focus {
    border: 0.08rem solid var(--fg);
  }
  @media (max-width: 900px) {
    div.header {
      gap: 0.5rem;
    }
    input[type="text"] {
      max-width: 50%;
    }
  }
  svg.paattu {
    fill: var(--fg);
  }
</style>
